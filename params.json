{"name":"Bareos-zabbix","tagline":"Scripts and templates to monitor backup jobs from Bareos in Zabbix.","body":"# Zabbix monitoring of Bareos's backup jobs and its processes\r\nМониторинг заданий Bareos производится посредством bash скриптов и perl скриптов. Perl скрипты используются в шаблонах Zabbix для низкоуровнего определия клиентов и списка заданий. мониторинг производится по каждому клиенту в разрезе каждого задания по уровням архивирования. Bash скрипты собирают информацию о выполненном задании из Bareos Catalog и передают в Zabbix. Создавалось и тестировалось на Bareos 15.2.0, Zabbix 2.4.5, Postgresql 9.4.3, в Calculate Linux.\r\n\r\n##Основные возможности\r\n- Низкоуровневое определение клиентов Bareos в Zabbix;\r\n- низкоуровневое определения заданий по клиентам Bareos в Zabbix;\r\n- раздельный учет каждого клиента Bareos в Zabbix;\r\n- раздельный учет каждого задания архивирования Bareos в Zabbix;\r\n- раздельный учет каждого уровня архивирования Bareos в Zabbix.\r\n\r\n##Особенности\r\n###Собираемые данные\r\n- статус завершения задания;\r\n- объем каждого задания;\r\n- количество файлов в задании;\r\n- время выполения задания;\r\n- скорость выполнения задания.\r\n\r\n##Состав\r\n\r\n###Шаблоны Zabbix\r\n- *Template Bareos Сlients* - шаблон для определения списка клиентов Bareos и создания хостов на Zabbix;\r\n- *Template Bareos Processes* - шаблон для мониторинга состояния процессов Bareos;\r\n- *Template Bareos* - шаблон для определения списка заданий по клиентам Bareos и создание элеменов в Zabbix хостах.\r\n\r\n###Скрипты\r\n- *bareos-zabbix.bash* - сбор данных из задания и отправка в Zabbix\r\n- *bareos.pl* - скрипт для пользовательских параметров Zabbix агента, для создания элементов заданий в хостах Zabbix\r\n- *bareos_hosts.pl* -скрипт для пользовательских параметров Zabbix агента, для создания хостов Zabbix\r\n\r\n\r\n##Установка\r\n\r\n1. Создать файлonf\r\n    chmod 640 /etc/bareos/bareos-zabbix.conf `/etc/bareos/bareos-zabbix.conf`,как в примере репозитория, отредактировать в соответствии со своими реалиями и установить права:\r\n  ```\r\n    chown root:bareos /etc/bareos/bareos-zabbix.c\r\n  ```\r\n\r\n2. Создать файл `/var/spool/bareos/bareos-zabbix.bash` копирование его из репозитория и установить права:\r\n  ```\r\n  chown bareos:bareos /var/spool/bareos/bareos-zabbix.bash\r\n  chmod 700 /var/spool/bareos/bareos-zabbix.bash\r\n  ```\r\n3. Оредактировать секцию `Messages` в `/etc/bareos/bareos-dir.conf`, добавив следующее:\r\n\r\n  ```\r\n  Messages {\r\n    ...\r\n    mailcommand = \"/var/spool/bareos/bareos-zabbix.bash %i\"\r\n    mail = 127.0.0.1 = all, !skipped\r\n    ...\r\n  }\r\n  ```\r\nтаким образом после каждого задания будет вызываться bash скрипт в котроый будет передваться ID задания.\r\n\r\n4. Скопировать из репозитория файлы `bareos.pl` и `bareos_hosts.pl` в папку со скриптами для агента Zabbix, В моем случае это: `/etc/zabbix/scripts/`, и установить права:\r\n\r\n  ```\r\n  chown zabbix:zabbix /etc/zabbix/scripts/bareos.pl\r\n  chown zabbix:zabbix /etc/zabbix/scripts/bareos_hosts.pl\r\n  chmod 700 /etc/zabbix/scripts/bareos.pl\r\n  chmod 700 /etc/zabbix/scripts/bareos_hosts.pl  \r\n  ```\r\n  \r\n5. Отредактировать конфигурационный файл Zabbix агента `/etc/zabbix/zabbix-agentd.conf`, добавив следующее:\r\n  \r\n  ```\r\n  UserParameter=bareos.jobs[*],/usr/bin/perl /etc/zabbix/scripts/bareos.pl $1                                       \r\n  UserParameter=bareos.hosts,/usr/bin/perl /etc/zabbix/scripts/bareos_hosts.pl\r\n  ```\r\n6. Перезаргузить настройки Bareos Director, для этого сделать следующее:\r\n\r\n  ```\r\n    /etc/init.d/bacula-dir restart\r\n  ```\r\n  или \r\n  ```\r\n    bconsole\r\n    reload\r\n    exit\r\n  ```\r\n7. Перезапустить zabbix-agent:\r\n\r\n  ```\r\n  /etc/init.d/zabbix-agentd restart\r\n  ```\r\n8. Импортировать в Zabbix шаблоны `bareos-template.xml`.\r\n9. В Zabbix подключить шаблон *Template Bareos Сlients* к хосту для которого правился конфиг агента.\r\n10. В Zabbix подключить шаблон *Template Bareos Processes* к хоста для которых нужно мониторить сотояние процессов.\r\n\r\n## Ссылки\r\n\r\n- **Bareos**:\r\n  - http://doc.bareos.org/master/html/bareos-manual-main-reference.html\r\n- **Zabbix**:\r\n  - https://www.zabbix.com/documentation/2.4/start\r\n\r\n\r\n## Feedback\r\n\r\nВопросы, замечания и предложения:\r\n\r\n- https://github.com/ssv1982/bacula-zabbix/issues\r\n\r\n## P.S.\r\nСоздано на основе:\r\n    https://github.com/germanodlf/bacula-zabbix.git\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}